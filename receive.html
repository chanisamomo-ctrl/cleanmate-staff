<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Receive</title>
  <style>
    body{font-family:system-ui,Arial; margin:16px;}
    label{display:block;margin-top:10px;}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;}
    button{width:100%;padding:12px;margin-top:14px;border-radius:10px;border:1px solid #111;}
    .muted{color:#666;font-size:13px;}
  </style>
</head>
<body>
  <h3>üß∫ ‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</h3>

  <label>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
  <select id="staff">
    <option value="S001">S001</option>
    <option value="S002">S002</option>
    <option value="S003">S003</option>
  </select>

  <label>‡∏™‡∏≤‡∏Ç‡∏≤</label>
  <select id="branch">
    <option value="B1">B1</option>
    <option value="B2">B2</option>
  </select>

  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
  <input id="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠"/>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
  <input id="phone" inputmode="numeric" placeholder="089xxxxxxx"/>

  <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
  <select id="service">
    <option value="WASH">‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥</option>
    <option value="DRY">‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á</option>
    <option value="OTHER">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  </select>

  <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
  <select id="item">
    <option value="Clothes">‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</option>
    <option value="Shoes">‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤</option>
    <option value="Bag">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</option>
    <option value="Doll">‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤</option>
    <option value="Other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  </select>

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô</label>
  <input id="qty" type="number" min="1" value="1"/>

  <label>‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó)</label>
  <input id="amount" type="number" min="0" value="0"/>

  <label>‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
  <select id="payMethod">
    <option value="CASH">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
    <option value="TRANSFER">‡πÇ‡∏≠‡∏ô</option>
    <option value="UNPAID">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</option>
  </select>

  <button onclick="submit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <div class="muted" id="msg"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwxRLFXKijxkzSPh2lgJtFflWPvSTIkStmNIsnsILIBAMUEkDM5MCaxzlfP4FUweystEw/exec";

    async function submit() {
      const phone = document.getElementById("phone").value.trim();
      if (!phone) { document.getElementById("msg").innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"; return; }

      document.getElementById("msg").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
      const method = document.getElementById("payMethod").value;
      const body = {
        action: "create_transaction",
        staff_id: document.getElementById("staff").value,
        branch_id: document.getElementById("branch").value,
        customer_name: document.getElementById("name").value.trim(),
        phone,
        service_type: document.getElementById("service").value,
        item_category: document.getElementById("item").value,
        item_count: Number(document.getElementById("qty").value || 1),
        amount_thb: Number(document.getElementById("amount").value || 0),
        payment_method: method,
        payment_status: (method === "UNPAID" ? "UNPAID" : "PAID"),
        remarks: ""
      };

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(body)
      });
      const data = await res.json();
      document.getElementById("msg").innerText = data.ok ? ("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + data.job_id) : ("‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + data.error);
    }
  </script>
</body>
</html>
